<ion-header class="ion-no-border">
  <ion-toolbar color="primary">
    <ion-title class="brand-title">Ghɔmala'</ion-title>
    <ion-buttons slot="end">
      <ion-button id="open-history">
        <ion-icon slot="icon-only" name="time-outline"></ion-icon>
      </ion-button>
      
      <ion-select [value]="ai.currentAppLang()" (ionChange)="ai.currentAppLang.set($event.detail.value)" interface="popover" class="code-select">
        <ion-select-option value="en">EN</ion-select-option>
        <ion-select-option value="fr">FR</ion-select-option>
        <ion-select-option value="de">DE</ion-select-option>
      </ion-select>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="responsive-wrapper">
    
    <div class="glass-container lang-bar">
      <ion-row class="ion-align-items-center">
        <ion-col size="5">
          <ion-select [value]="sourceLang()" (ionChange)="sourceLang.set($event.detail.value)" interface="popover" class="chrome-fix">
            <ion-select-option value="french">French</ion-select-option>
            <ion-select-option value="english">English</ion-select-option>
            <ion-select-option value="german">German</ion-select-option>
            <ion-select-option value="ghomala">Ghomálá’</ion-select-option>
          </ion-select>
        </ion-col>
        <ion-col size="2" class="ion-text-center">
          <div class="swap-circle" (click)="swapLanguages()">
            <ion-icon name="swap-horizontal-outline"></ion-icon>
          </div>
        </ion-col>
        <ion-col size="5">
          <ion-select [value]="targetLang()" (ionChange)="targetLang.set($event.detail.value)" interface="popover" class="chrome-fix">
            <ion-select-option value="ghomala">Ghomálá’</ion-select-option>
            <ion-select-option value="french">French</ion-select-option>
            <ion-select-option value="english">English</ion-select-option>
            <ion-select-option value="german">German</ion-select-option>
          </ion-select>
        </ion-col>
      </ion-row>
    </div>

    <div class="workspace-card white-bg">
   <!--    <div class="input-tools-top">
    @if (inputText()) {
      <div class="clear-btn" (click)="inputText.set('')">
        <span>CLEAR</span>
        <ion-icon name="close-circle"></ion-icon>
      </div>
    }
  </div> -->
      <ion-textarea 
        [value]="inputText()" 
        (ionInput)="inputText.set($event.detail.value!)" 
        [placeholder]="ai.getUI('input')" 
        autoGrow="true" 
        rows="8" 
        class="main-textarea">
      </ion-textarea>
      
      <div class="nested-controls">
        <div class="left-group">
          <div class="mini-btn-main" 
               (click)="handleTranslate()" 
               [class.disabled]="isAutoTranslate() || !inputText().trim()">
            @if (isLoading()) {
              <ion-spinner name="crescent" color="light"></ion-spinner>
            } @else {
              <span>Tutə</span>
            }
          </div>

          <div class="mini-auto-pill" (click)="toggleAuto()" [class.active]="isAutoTranslate()">
            <ion-icon [name]="isAutoTranslate() ? 'flash' : 'flash-outline'"></ion-icon>
            <span>Auto</span>
          </div>
        </div>

        <div class="right-group">
          @if (inputText()) {
          <div class="icon-btn-secondary" (click)="inputText.set('')" [class.disabled]="!inputText()">
           <ion-icon name="close-outline"></ion-icon>
         </div>
          }
      <div class="icon-btn-secondary" (click)="copyToClipboard(inputText())" [class.disabled]="!inputText()">
        <ion-icon name="copy-outline"></ion-icon>
      </div>
      <div class="keyboard-trigger" (click)="toggleChars()">
        <ion-icon name="keypad-outline"></ion-icon>
      </div>
    </div>
      </div>

      @if (showSpecialChars()) {
        <div class="char-popup">
          <div class="char-grid">
            @for (c of ['ə', 'ɔ', 'ʉ', 'ŋ', 'ɑ', 'i', 'o', 'm','`','´', '^', ' ̌']; track c) {
              <div (click)="addChar(c)" class="char-key">{{c}}</div>
            }
          </div>
        </div>
      }
    </div>

    @if (outputText()) {
      <div class="result-container">
        <div class="result-display-modern">
  <div class="result-top">
    <ion-badge color="primary">{{ targetLang() | uppercase }}</ion-badge>
    <div class="result-tools">
      <ion-button fill="clear" (click)="copyToClipboard(outputText())">
        <ion-icon name="copy-outline" slot="icon-only"></ion-icon>
      </ion-button>
      <ion-button fill="clear" (click)="ai.speak(outputText(), targetLang())">
        <ion-icon name="volume-high-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </div>
  </div>
  <p class="output-text">{{ outputText() }}</p>
</div>

        @if (dictionaryResults().length > 0) {
          <div class="dictionary-display chrome-render-fix">
            <h3 class="dict-title">Vocabulary</h3>
            <div class="dict-scroll">
              @for (word of dictionaryResults(); track $index) {
                <div class="dict-item">
                  <span class="dict-ghomala">{{ word.ghomala }}</span>
                  <span class="dict-sep">:</span>
                  <span class="dict-target">{{ word.translation }}</span>
                </div>
              }
            </div>
          </div>
        }
      </div>
    }

    <ion-modal trigger="open-history" [initialBreakpoint]="0.5" [breakpoints]="[0, 0.5, 0.8]" mode="ios">
      <ng-template>
        <ion-header class="ion-no-border">
          <ion-toolbar>
            <ion-title>History</ion-title>
            <ion-buttons slot="end">
              <ion-button (click)="clearHistory()" color="danger">
                <ion-icon name="trash-outline" slot="icon-only"></ion-icon>
              </ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header>
        <ion-content class="ion-padding">
          @if (history().length === 0) {
            <div class="empty-state">No recent translations</div>
          } @else {
            @for (item of history(); track $index) {
              <div class="history-card">
                <div class="h-input">{{ item.input }}</div>
                <div class="h-output">{{ item.output }}</div>
              </div>
            }
          }
        </ion-content>
      </ng-template>
    </ion-modal>

  </div>
</ion-content>
